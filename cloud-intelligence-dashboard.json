{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Description": "FinOps Cloud Intelligence Dashboard",

  "Parameters": {
    "AthenaWorkgroup": {
      "Type": "String",
      "Default": "finops-workgroup"
    },
    "CURDatabaseName": {
      "Type": "String",
      "Default": "finops_cur_db"
    },
    "CURTableName": {
      "Type": "String",
      "Default": "cost_and_usage_report"
    }
  },

  "Resources": {

    "QuickSightDataSource": {
      "Type": "AWS::QuickSight::DataSource",
      "Properties": {
        "AwsAccountId": { "Ref": "AWS::AccountId" },
        "DataSourceId": "finops-athena-datasource",
        "Name": "FinOps Athena DataSource",
        "Type": "ATHENA",
        "DataSourceParameters": {
          "AthenaParameters": {
            "WorkGroup": { "Ref": "AthenaWorkgroup" }
          }
        },
        "Permissions": [
          {
            "Principal": {
              "Fn::Sub": "arn:aws:quicksight:${AWS::Region}:${AWS::AccountId}:user/default/${AWS::AccountId}"
            },
            "Actions": [
              "quicksight:DescribeDataSource",
              "quicksight:DescribeDataSourcePermissions",
              "quicksight:PassDataSource",
              "quicksight:UpdateDataSource",
              "quicksight:DeleteDataSource"
            ]
          }
        ]
      }
    }

  },

  "Outputs": {
    "DashboardStatus": {
      "Value": "QuickSight DataSource Created. Create dashboard manually or use full CID template."
    }
  }
}
